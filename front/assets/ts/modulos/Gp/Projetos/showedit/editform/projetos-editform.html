<div class="custom-form-view" ng-if="$ctrl.entity"> <!-- Uso o ng-if para que os componentes só tenham seus scopes inicializados quando a entity estiver disponível -->
    <div class="nsj-form-view">
      <div class="row">
        <div class="col-sm-12">
          <fieldset class="field-set">
            <legend>Dados do Projeto</legend>
            <div class="row">
              <div class="col-sm-4">
                <div class="form-group">
                  <label for="codigo" class="control-label">Código</label>
                  <input type="text" name="codigo" class="form-control" ng-model="$ctrl.entity.codigo" ng-disabled="true||true||$ctrl.entity.$$__submitting" />
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group">
                  <label for="nome" class="control-label">Nome</label>
                  <input type="text" name="nome" class="form-control" ng-model="$ctrl.entity.nome" ng-disabled="$ctrl.entity.atc" ng-required="true" />
                  <div ng-messages="$ctrl.form.nome.$error" ng-if="$ctrl.form.nome.$dirty || $ctrl.form.$submitted">
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span>
                      <span class="sr-only">Erro:</span>
                      O campo Nome não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-4">
                <div class="form-group">
                  <label for="estabelecimento.nomefantasia" class="control-label">Estabelecimento</label>
                  <nsj-lookup
                    name="estabelecimento"
                    id-name="estabelecimento"
                    factory="NsEstabelecimentos"
                    ng-model="$ctrl.entity.estabelecimento"
                    max-label="1"
                    constructor="{  }"
                    config='{ "nomefantasia":"Nome",  }'
                    ng-disabled="$ctrl.entity.atc"
                    required="true"
                    ns-required="true"
                    ></nsj-lookup>
                    <div
                    ng-messages="$ctrl.form.estabelecimento.$error"
                    ng-if="$ctrl.form.estabelecimento.$dirty || $ctrl.form.$submitted"
                    >
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span
                      ><span class="sr-only">Erro:</span>
                      O campo estabelecimento não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="tipoprojeto" class="control-label">Tipo de projeto</label>
                  <nsj-lookup name="tipoprojeto" id-name="tipoprojeto" factory="GpTiposprojetos"
                    ng-model="$ctrl.entity.tipoprojeto" constructor="{  }"
                    config=' { "descricao":"Nome", "codigo": "Código"}'
                    ng-disabled="$ctrl.entity.atc"
                    required="true"
                    ns-required="true">
                  </nsj-lookup>
                  <div
                    ng-messages="$ctrl.form.tipoprojeto.$error"
                    ng-if="$ctrl.form.tipoprojeto.$dirty || $ctrl.form.$submitted"
                    >
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span
                      ><span class="sr-only">Erro:</span>
                      O campo tipo de projeto não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="cliente.nomefantasia" class="control-label">Cliente</label>
                  <nsj-lookup name="cliente" id-name="cliente" factory="NsClientes" ng-model="$ctrl.entity.cliente"
                    filter="{ 'tipo': [ {'condition':'eq','value': 1 },  ], }" max-label="1" constructor="{  }"
                    config='{"nomefantasia":"nomefantasia"}'
                    ng-disabled="$ctrl.entity.atc"
                    required="true"
                    ns-required="true">
                  </nsj-lookup>
                  <div
                    ng-messages="$ctrl.form.cliente.$error"
                    ng-if="$ctrl.form.cliente.$dirty || $ctrl.form.$submitted"
                    >
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span
                      ><span class="sr-only">Erro:</span>
                      O campo cliente não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="datainicio" class="control-label">Início</label>
                  <nsj-date-picker
                    remove-others="true" 
                    datepickeropts="{'disable-days-after': '$ctrl.entity.datafim'}" 
                    class="filter-date-pickers"
                    init-value="$ctrl.entity.datainicio"
                    editable='true'  
                    date-position="right" 
                    type-select="single"
                    opts="{'class':'form-control input-filtros-data', 
                    'id':'datainicio', 
                    'name':'datainicio' , 
                    'ng-model':'$ctrl.entity.datainicio', 
                    'placeholder': 'Digite ou selecione a data inicial', 
                    'ng-required':'true' }"
                    >
                  </nsj-date-picker>
                  <div
                    ng-messages="$ctrl.form.datainicio.$error"
                    ng-if="$ctrl.form.datainicio.$dirty || $ctrl.form.$submitted"
                    >
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span
                      ><span class="sr-only">Erro:</span>
                      O campo início não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label for="datafim" class="control-label">Fim</label>
                    <nsj-date-picker remove-others="true" 
                    datepickeropts="{'disable-days-before': '$ctrl.entity.datainicio'}" 
                    editable='true'
                    init-value='$ctrl.entity.datafim' 
                    date-position="right" 
                    type-select="single"
                    opts="{'class':'form-control input-filtros-data', 
                    'id':'datafim', 
                    'name':'datafim' , 
                    'ng-model':'$ctrl.entity.datafim', 
                    'placeholder': 'Digite ou selecione a data final', 
                    }"
                    >
                  </nsj-date-picker>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-3">
                <div class="form-group">
                  <label for="codigo" class="control-label">Responsável</label>
                  <nsj-lookup name="contas" id-name="contas" factory="DiretorioContas" ng-model="$ctrl.entity.responsavel_conta_nasajon"
                    max-label="1" constructor="{  }" config='{ "nome":"nome"}' disabled="$ctrl.entity.$$__submitting"
                    ng-disabled="$ctrl.entity.atc"
                    required="true"
                    ns-required="true">
                  </nsj-lookup>
                  <div
                    ng-messages="$ctrl.form.contas.$error"
                    ng-if="$ctrl.form.contas.$dirty || $ctrl.form.$submitted"
                    >
                    <div class="alert alert-danger" role="alert" ng-message="required">
                      <span class="fa fa-exclamation-circle" aria-hidden="true"></span
                      ><span class="sr-only">Erro:</span>
                      O campo responsável não pode ser vazio.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
          <fieldset>
            <legend ng-if="$ctrl.entity.tipoprojeto.exibirdeclaracaoescopoinfadic ||
            $ctrl.entity.tipoprojeto.exibirobjetivosinfadic ||
            $ctrl.entity.tipoprojeto.exibirpremissasinfadic ||
            $ctrl.entity.tipoprojeto.exibirrestricoesinfadic ||
            $ctrl.entity.tipoprojeto.exibirriscosinfadic
            ">Informações adicionais</legend>
            <div class="row">
              <div class="col-sm-6" ng-if="$ctrl.entity.tipoprojeto.exibirdeclaracaoescopoinfadic">
                <div class="form-group">
                  <label for="declaracaoescopo" class="control-label">Declaração de escopo</label>
                  <textarea name="declaracaoescopo" ng-model="$ctrl.entity.declaracaoescopo" class="form-control"
                    rows="3"></textarea>
                </div>
              </div>
              <div class="col-sm-6" ng-if="$ctrl.entity.tipoprojeto.exibirobjetivosinfadic">
                <div class="form-group">
                  <label for="objetivoscriterios" class="control-label">Objetivos e critério</label>
                  <textarea name="objetivoscriterios" ng-model="$ctrl.entity.objetivoscriterios" class="form-control"
                    rows="3"></textarea>
                </div>
              </div>
            
          
              <div class="col-sm-6" ng-if="$ctrl.entity.tipoprojeto.exibirpremissasinfadic">
                <div class="form-group">
                  <label for="premissas" class="control-label">Premissas</label>
                  <textarea name="premissas" ng-model="$ctrl.entity.premissas" class="form-control" rows="3"></textarea>
                </div>
              </div>
              <div class="col-sm-6" ng-if="$ctrl.entity.tipoprojeto.exibirrestricoesinfadic">
                <div class="form-group">
                  <label for="restricoes" class="control-label">Restrições</label>
                  <textarea name="restricoes" ng-model="$ctrl.entity.restricoes" class="form-control" rows="3"></textarea>
                </div>
              </div>
            
          
              <div class="col-sm-6" ng-if="$ctrl.entity.tipoprojeto.exibirriscosinfadic">
                <div class="form-group">
                  <label for="estimativasrisco" class="control-label">Estimativa de risco</label>
                  <textarea name="estimativasrisco" ng-model="$ctrl.entity.estimativasrisco" class="form-control"
                    rows="3"></textarea>
                </div>
              </div>
            </div>
          </fieldset>
          <fieldset ng-if="$ctrl.entity.dadosAtc">
            <legend>Dados do atendimento comercial</legend>
            <div class="row">
              <div class="col-sm-12">
                <div class="form-group flex flexdir-row align-itens-center">
                  <label for="codigo" class="control-label">Atendimento comercial</label>
                  <span>
                    <a ui-sref="crm_atcs_full({ atc: $ctrl.entity.atc })" target="_blank">
                      {{ $ctrl.entity.dadosAtc.codigo }} - {{ $ctrl.entity.dadosAtc.nome }}
                    </a>
                  </span>
                  <nsj-button class="ml-30" icon="fas fa-eye"
                    ng-click="$ctrl.openDocumentosNecessariosModal($ctrl.entity.dadosAtc.negociostiposdocumentosrequisitantes)">
                    Documentos necessários
                  </nsj-button>
                </div>
              </div>
            </div>
            <div class="mt-20 row">
              <div class="col-sm-12 form-group clearfix">
                <object-list class="object-list" entities='$ctrl.entity.dadosAtc.negociosdadosseguradoras'
                  service="CrmAtcsdadosseguradoras" constructors="{ 'negocio' : $ctrl.entity.dadosAtc.negocio,  }"
                  autosaveEnabled=>
                  <div>
                    <div>
                      <table class="table table-striped table-hover table-condensed table-bordered">
                        <thead>
                          <tr>
                            <th>Seguradora</th>
                            <th>Telefone</th>
                            <th>Produto</th>
                            <th>Apólice</th>
                            <th>Valor</th>
                            <th>Sinistro</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr ng-repeat="subentity in oblistctrl.entities" ng-controller="ObjectListItemCtrl as itemctrl">
                            <td>{{ subentity.seguradora.nomefantasia }} </td>
                            <td>
                              <!-- Tratando os possíveis inputs de DDI -->
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi.length === 1 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi | mask: '+9' ) : ''}}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi.length === 2 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi | mask: '+99' ) : ''}}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi.length === 3 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddi | mask: '+999' ) : ''}}

                              <!-- Tratando os possíveis inputs de DDD -->
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd.length === 1 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd | mask: '(9)' ) : ''}}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd.length === 2 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd | mask: '(99)') : ''}}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd.length === 3 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceiroddd | mask: '(999)') : ''}}

                              <!-- Tratando os possíveis inputs de telefone -->
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length === 1 ? 'Não informado' : ''}}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length === 8 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone | mask: '9999-9999') : '' }}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length === 9 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone | mask: '99999-9999') : '' }}
                              {{ $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length !== 0 &&
                              $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length !== 8 &&
                              $ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone.length !== 9 ?
                              ($ctrl.dadosSeguradoras[subentity.seguradora.cliente].respfinanceirotelefone) : ''
                              }}
                            </td>
                            <td>{{ subentity.produtoseguradora.nome ? subentity.produtoseguradora.nome : 'Não informado' }} </td>
                            <td> {{ subentity.apolice.nome ? subentity.apolice.nome : 'Não informado' }} </td>
                            <td>{{ subentity.apolice.valorapolice ? 'R$ ' + subentity.apolice.valorapolice : 'Não informado' }}</td>
                            <td>{{ subentity.sinistro ? subentity.sinistro : 'Não informado' }} </td>
                          </tr>
                        </tbody>
                        <tfoot ng-if="oblistctrl.entities.length == 0">
                          <tr>
                            <td colspan="15" class="state-empty">
                              <div class="empty-list">
                                <p class="text-center"> Não existem itens para mostrar nesta lista. </p>
                              </div>
                            </td>
                          </tr>
                        </tfoot>
                      </table>
                    </div>
                  </div>
                </object-list>
              </div>
            </div>
            <div class="row" ng-if="$ctrl.camposCustomizados.dadosResponsavelFull">
              <div ng-repeat="campo in $ctrl.dadosResponsavelPrimario" class="col-sm-3">
                <div class="form-group">
                  <label class="control-label">{{ campo.label }}</label>
                  {{ campo.value ? campo.value : 'Não informado' }}
                </div>
              </div>
              <div ng-repeat="campo in $ctrl.dadosResponsavelSecundario" class="col-sm-3">
                <div class="form-group">
                  <label class="control-label">{{ campo.label }}</label>
                  {{ campo.value ? campo.value : 'Não informado' }}
                </div>
              </div>
            </div>
            <div class="row" ng-if="$ctrl.camposCustomizados.dadosFalecidoResumido">
              <div ng-repeat="campo in $ctrl.dadosFalecido" class="col-sm-3">
                <div class="form-group">
                  <label class="control-label">{{ campo.label }}</label>
                  {{ campo.value ? campo.value : 'Não informado' }}
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="form-group">
                  <label for="endereco" class="control-label">Endereço</label>
                  {{ $ctrl.entity.dadosAtc.localizacaotipologradouro.descricao }}
                  {{ $ctrl.entity.dadosAtc.localizacaorua }},
                  {{ $ctrl.entity.dadosAtc.localizacaonumero }} -
                  {{ $ctrl.entity.dadosAtc.localizacaomunicipio.nome }},
                  {{ $ctrl.entity.dadosAtc.localizacaoestado.nome }} -
                  {{ $ctrl.entity.dadosAtc.localizacaoestado.uf }},
                  {{ $ctrl.entity.dadosAtc.localizacaocep }}
                </div>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
      <div class="pull-left btn-controle-atc-show-container">
        <button type="button" ng-click="$ctrl.submit()" ng-class="{loading:$ctrl.busySubmit}"
          ng-disabled="$ctrl.busySubmit || $ctrl.form.$pristine" class="btn btn-sm btn-warning btn-save btn-geral">
          <i class="fa fa-check"></i>
          Salvar
        </button>
        <a class="btn btn-sm" ng-click="$ctrl.setEdit(false)">
          <i class="fa fa-times" aria-hidden="true"></i>
          Cancelar
        </a>
      </div>
    </div>
</div>
