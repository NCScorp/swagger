{% block header %}

<nsj-header>
  
    {% set tenantLogo = "//s3-us-west-2.amazonaws.com/static.nasajon/img/logo.png" %}
    {% if (permissionFormat() == 'tenant_empresa_funcao' or permissionFormat() == 'tenant') and provisao().tenantLogo is not null  %}
        {% set tenantLogo = provisao().tenantLogo %}
    {% endif %}
    <navbar-logo data-mobile-src="https://s3-us-west-2.amazonaws.com/static.nasajon/img/logo-reduzida.png" data-src="{{tenantLogo}}"></navbar-logo>

    <navbar-text data-module="{{ nsj_module_name() }}" data-system="{{ nsj_application_name() }}"></navbar-text>

    <navbar-collapse>
        <ul class="nav navbar-nav navbar-right">
          {% if app.user is not null %}
            <li id="toggle-provisoes" uib-dropdown auto-close="outsideClick">
                <a href="#" uib-dropdown-toggle class="profile-image" title="{{ app.user.nome }} {{ app.user.sobrenome }} ({{ app.user.username }})">
                    {{ app.user.nome }} {{ app.user.sobrenome }}
                    <span class="caret"></span>
                </a>

                <ul id="header-provisoes" class="dropdown-menu goog-menu box-arrow list-unstyled" uib-dropdown-menu aria-labelledby="simple-dropdown">

                    <li class="header no-hover user-info" role="presentation">

                        <navbar-user data-name="{{ app.user.nome }} {{ app.user.sobrenome }}" data-email="{{ app.user.username }}"></navbar-user>

                        {% if 'admin' in app.request.pathInfo %}
                        <div class="switch switch-sm" ng-controller="MenuCtrl as controller">
                            <input ng-if="controller.usuarioDisponivelQuemDetermina == 1 || controller.isAdmin" id="status_usuario" name="status_usuario" type="checkbox" ng-checked="controller.usuarioDisponivel" ng-model="controller.usuarioDisponivel" ng-change="controller.alterarDisponibilidade(controller.usuarioDisponivel)">
                            <label ng-if="controller.usuarioDisponivelQuemDetermina == 1 || controller.isAdmin" for="status_usuario" class="label-success"></label>
                            <small title="{{'{{controller.tituloUsuarioDisponivelQuemDetermina}}'}}" class="text-uppercase" ng-if="controller.usuarioDisponivel">{{'usuariodisponivel'|trans}}</small>
                            <small title="{{'{{controller.tituloUsuarioDisponivelQuemDetermina}}'}}" class="text-uppercase" ng-if="!controller.usuarioDisponivel">{{'usuarioindisponivel'|trans}}</small>
                        </div>
                        {% endif %}

                        <div class="clearfix user-menu">
                          <a href="{{ nsj_usuario_app_url() }}" class="user-menu-item btn btn-primary btn-sm">Minha Conta</a>
                          {% if permissionFormat() is not null and (app.user.permissoes|length > 0) %}
                            <a href="{{ path('main_index') }}" class="visible-xs user-menu-item">Alterar Função</a>
                          {% endif %}
                          <a href="{{ path('logout') }}" class="user-menu-item btn btn-default btn-sm">Sair</a>
                          {% if 'admin' in app.request.pathInfo %}
                            <a href="{{ url('atendimento_cliente_index', { tenant : provisao().tenant } ) }}" target="_blank" class="link-portal pull-right">Ir para o portal</a>
                          {% endif %}
                        </div>

                    </li>

                    {% if 'admin' in app.request.pathInfo %}
                          {% if permissionType() == 'provisao' %}
                              {% if permissionFormat() == 'tenant_funcao'%}
                                  <li class="header">Escolha uma função</li>
                                      {% for tenant, permissoes in app.user.permissoes %}
                                          {% for permissao in permissoes %}
                                          {{app.user.isAdministrador(tenant)}}
                                          <li class="goog-menuitem">
                                              <a href="{{ path('index', {'tenant': tenant, 'funcao': permissao|lower }) }}">
                                                  <div style="background-image: url({{ app.user.tenants[tenant].logo }})">
                                                      {{app.user.tenants[tenant].sistemas[app.user.sistemaAtual].funcoes[permissao].nome}}
                                                      <br>
                                                      Organização: {{app.user.tenants[tenant].nome}}
                                                  </div>
                                              </a>
                                          </li>
                                      {% endfor %}
                                  {% endfor %}
                              {% else %}
                                  <li class="header">Escolha uma organização</li>
                                      {% for tenant, permissoes in app.user.permissoes %}
                                          {% for permissao in permissoes %}
                                              {% if permissao == 'ADMIN' %}
                                              <li class="goog-menuitem">
                                                  <a href="{{ path('index', {'tenant': tenant}) }}">
                                                      <div style="background-image: url({{ app.user.tenants[tenant].logo }})">
                                                          {{app.user.tenants[tenant].sistemas[app.user.sistemaAtual].funcoes[permissao].nome}}
                                                          <br />
                                                          Organização: {{app.user.tenants[tenant].nome}}
                                                      </div>
                                                  </a>
                                              </li>
                                          {% endif %}
                                      {% endfor %}
                                  {% endfor %}
                              {% endif %}

                          {% elseif permissionType() == 'administracao' %}

                              <li class="header">Escolha uma organização</li>
                                  {% for administracao in app.user.permissoes %}
                                  <li class="goog-menuitem">
                                      <a href="{{ path('index', {'tenant': administracao }) }}">
                                          <div >
                                              Organização: {{administracao}}
                                          </div>
                                      </a>
                                  </li>
                              {% endfor %}
                          {% endif %}
                          {% endif %}
                      </ul>

            </li>
            <li><a href="{{ path('logout') }}"><i class="nsj-icon nsj-icon-sair"></i></a></li>
            {% endif %}

            {% if app.user is null %}
            <li id="toggle-provisoes" uib-dropdown auto-close="outsideClick">
                <a href="/" class="profile-image" title="Fazer Login">
                    Fazer Login
                </a>
            </li>
            {% endif %}
        </ul>
    </navbar-collapse>
</nsj-header>

{% endblock %}