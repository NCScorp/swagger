<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="atcspendencias" label="atcspendencias" project="crm" orphan="false">
  <entity schema="crm" table="atcspendencias">
    <!--
        Atenção:
        ao realizar alterações neste model, por favor conferir o arquivo 
        AppBundle/Repository/Crm/AtcspendenciasRepository.php
        e fazer as devidas modificações (pois o repository foi sobrescrito)
    -->
    <fieldmodel name="negociopendencia" datatype="guid" isid="true" column="negociopendencia"/>
    <fieldmodel name="numero" datatype="integer" column="numero" />
    <fieldmodel name="texto" datatype="string"  column="texto"/>
    <fieldmodel name="negociopendencialista" datatype="guid"  column="negociopendencialista" useCaseLink="crm\atcspendenciaslistas" entityJoinType="left"/>
    <fieldmodel name="realizada" datatype="boolean"  column="realizada"/>
    <fieldmodel name="fechadaem" datatype="datetime"  column="realizada_em"/>
    <fieldmodel name="fechadapor" datatype="json"  column="realizada_por"/>
    <fieldmodel name="created_at" datatype="datetime"  column="created_at"/>
    <fieldmodel name="created_by" datatype="json"  column="created_by"/>
    <fieldmodel name="updated_at" datatype="datetime"  column="updated_at"/>
    <fieldmodel name="updated_by" datatype="json"  column="updated_by"/>
    <fieldmodel name="tenant" datatype="integer"  column="tenant"/>
    <fieldmodel name="atribuidoa" datatype="string" column="atribuidoa"/>
    <fieldmodel name="prioridade" datatype="guid"  column="prioridade" useCaseLink="ns\prioridades" entityJoinType="left"/>
    <fieldmodel name="prazo" datatype="integer" column="prazo" />
    <fieldmodel name="temponotificaexpiracao" datatype="integer" column="temponotificaexpiracao" />
    <fieldmodel name="impeditivo" datatype="integer" column="impeditivo" >
        <options>{"0":"Interno","1":"Cliente","2":"Fornecedor","3":"Família"}</options>
    </fieldmodel>
    <fieldmodel name="impeditivofornecedor" datatype="guid"  column="impeditivofornecedor"/>
    <fieldmodel name="impeditivocliente" datatype="guid"  column="impeditivocliente"/>
    <fieldmodel name="status" datatype="integer" column="status" >
        <options>{"0":"Aberta","1":"Fechada"}</options>
    </fieldmodel>
    <fieldmodel name="tipodescricao" datatype="integer" notMapped="true">
        <options>{"0":"Global","1":"Específica"}</options>
    </fieldmodel>
    <fieldmodel name="negocio" datatype="guid" column="negocio" useCaseLink="crm\atcs" entityJoinType="left"/>
    <fieldmodel name="atribuidoamim" datatype="boolean"  notMapped="true"/>
    <!-- Utilizado para criar um bloco que será substituído no modal de edição -->
    <fieldmodel name="block_table" datatype="string" notMapped="true"/>
    <fieldmodel name="historicopadrao" datatype="guid" notMapped="true" useCaseLink="crm\historicospadrao" />
    <fieldmodel name="id_grupoempresarial" datatype="guid" column="grupoempresarial"/>
    <fieldmodel name="dataprazopendencia" datatype="datetime" column="dataprazopendencia"/>
    <!-- Atributo usado para diferenciar quando está editando ou fechando uma pendência, para realizar verificações no service -->
    <fieldmodel name="fecharpendencia" datatype="boolean" notMapped="true"/>
  </entity>
  <constructors>
    <constructoritem>tenant</constructoritem>
    <constructoritem>id_grupoempresarial</constructoritem>
  </constructors>
  <viewbrowser label="Pendências" layout="list" paginate="true" target="window" itemsPerPage="50">
    <fieldsbrowser>
      <fieldbrowser entitylink="negociopendencia" isid="true" visible="false"/>
      <fieldbrowser entitylink="numero" alias="Número" visible="true" cansearch="false"/>
      <fieldbrowser entitylink="texto" alias="Texto" visible="true" cansearch="true"/>
      <fieldbrowser alias="Pendência" entitylink="texto" visible="true" cansearch="true"/>
      <fieldbrowser alias="Realizada" entitylink="realizada" visible="true" cansearch="false"/>
      <fieldbrowser entitylink="negociopendencialista" visible="false" cansearch="true" fielddetaillookup="{'nome': 'nome'}"/>
      <fieldbrowser entitylink="prioridade" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="prazo" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="temponotificaexpiracao" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="status" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="impeditivo" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="created_by" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="created_at" visible="false" cansearch="false" alloworder="true"/>
      <fieldbrowser entitylink="atribuidoa" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="negocio" visible="false" cansearch="true" fielddetaillookup="{'codigo': 'Codigo'}" />
      <fieldbrowser entitylink="fechadapor" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="fechadaem" visible="false" cansearch="false"/>
      <fieldbrowser entitylink="dataprazopendencia" visible="false" cansearch="false" />
    </fieldsbrowser>
        <filters style="fixed">
            <fieldsfilters>
                <fieldfilter entitylink="negocio"  maxoccurs='unbounded'>
                    <lookup fielddetail="{'codigo':'Codigo'}" allowinsert="false" />
                    <conditions>
                        <condition type="eq"/>
                    </conditions>
                </fieldfilter>
                <fieldfilter entitylink="status" >
                    <conditions>
                        <condition type="eq"/>
                    </conditions>
                </fieldfilter>
                <fieldfilter entitylink="negociopendencialista" >
                    <conditions>
                        <condition type="eq"/>
                    </conditions>
                </fieldfilter>
                <fieldfilter entitylink="atribuidoa" >
                    <conditions>
                        <condition type="eq"/>
                    </conditions>
                </fieldfilter>
                <fieldfilter entitylink="prioridade" >
                    <conditions>
                        <condition type="eq"/>
                    </conditions>
                </fieldfilter>
            </fieldsfilters>
        </filters>
  </viewbrowser>
  <forms>
    <form name="default" label="Pendência">
        <layout>
            <headerform>
                <row>
                    <cell controltype="lookup" label="historicopadrao" colspan="12" entitylink="historicopadrao" fielddetaillookup="{'codigo':'codigo', 'descricao':'descricao'}" amountfieldslookup="2">
                        <filter field="tipo" condition="eq" value="100"/>
                        <filter field="tipo" condition="eq" value="102"/>
                    </cell>
                </row> 
                <row>
                    <cell controltype="textarea" label="Descrição" colspan="12" entitylink="texto">
                        <validates>
                            <validate type="vnull" displaytext="O campo descrição não pode estar vazio"></validate>
                        </validates>
                    </cell>
                </row>
                 <row>
                    <cell controltype="lookup" label="Tipo de pendência" colspan="4" entitylink="negociopendencialista" fielddetaillookup="{'nome':'Nome'}" amountfieldslookup="1" allowinsertlookup="true">
                        <validates>
                            <validate type="vnull" displaytext="O campo Tipo de pendência não pode ser vazio."/>
                        </validates>
                    </cell>
                    <!-- <cell controltype="number" label="Prazo para expiração" colspan="4" entitylink="prazo">
                        <validates>
                            <validate type="vnull" displaytext="O campo Prazo não pode estar vazio"></validate>
                            <validate type="greaterthan" value="0" displaytext="O prazo deve ser maior que 0."/>
                        </validates>
                    </cell> -->
                    <cell controltype="dateinput" label="dataprazopendencia" colspan="4" entitylink="dataprazopendencia">
                        <validate type="vnull" displaytext="O campo data prazo pendencia não pode estar vazio"></validate>
                    </cell>
                    
                    <cell controltype="number" label="Notificar expiração faltando" colspan="4" entitylink="temponotificaexpiracao">
                        <validates>
                            <validate type="vnull" displaytext="O campo Notificar Expiração não pode estar vazio"></validate>
                            <validate type="greaterthan" value="0" displaytext="O campo Notificar Expiração deve ser maior que 0."/>
                        </validates>
                    </cell>
                    <cell controltype="lookup" label="Atendimento Comercial" colspan="0" entitylink="negocio" fielddetaillookup="{'codigo':'Codigo'}" amountfieldslookup="1" allowinsertlookup="true">
                        <validates>
                            <validate type="vnull" displaytext="O campo Negócio não pode ser vazio."/>
                        </validates>
                    </cell>
                </row>
                <row>
                    <cell controltype="checkbox" colspan="12" label="Atribuído a mim" entitylink="atribuidoamim">
                        <validate type="vnull" displaytext="O campo Atribuído a mim não pode ser vazio."/>
                    </cell>
                </row>
                <row>
                    <cell controltype="lookup" label="Nível de prioridade" colspan="6" entitylink="prioridade" fielddetaillookup="{'nome':'Nome'}" amountfieldslookup="1" allowinsertlookup="true">
                        <validates>
                            <validate type="vnull" displaytext="O campo Nível de prioridade não pode ser vazio."/>
                        </validates>
                    </cell>
                    <cell name="impeditivo" entitylink="impeditivo" colspan="6" label="Responsável do impeditivo" controltype="combobox" />
                </row>
            </headerform>
        </layout>
    </form>
    <form name="edit" label="Consultar Pendência">
        <layout>
            <headerform>
                <row>
                    <cell controltype="textedit" colspan="12" entitylink="block_table">
                    </cell>
                </row>
                <row>
                    <!-- <cell controltype="number" label="Prazo para expiração" colspan="4" entitylink="prazo">
                        <validates>
                            <validate type="vnull" displaytext="O campo Prazo não pode estar vazio"></validate>
                            <validate type="greaterthan" value="0" displaytext="O prazo deve ser maior que 0."/>
                        </validates>
                    </cell> -->
                    <cell controltype="dateinput" label="dataprazopendencia" colspan="4" entitylink="dataprazopendencia">
                        <validate type="vnull" displaytext="O campo data prazo pendencia não pode estar vazio"></validate>
                    </cell>
                    
                    <cell controltype="number" label="Notificar expiração faltando" colspan="4" entitylink="temponotificaexpiracao">
                        <validates>
                            <validate type="vnull" displaytext="O campo Notificar Expiração não pode estar vazio"></validate>
                            <validate type="greaterthan" value="0" displaytext="O campo Notificar Expiração deve ser maior que 0."/>
                        </validates>
                    </cell>
                </row>
                <row readonly="status == 1">
                    <cell controltype="lookup" label="Nível de prioridade" colspan="6" entitylink="prioridade" fielddetaillookup="{'nome':'Nome'}" amountfieldslookup="1" allowinsertlookup="true">
                        <validates>
                            <validate type="vnull" displaytext="O campo Nível de prioridade não pode ser vazio."/>
                        </validates>
                    </cell>
                    <cell controltype="textedit" colspan="6" label="Atribuido a" entitylink="atribuidoa">
                    </cell>
                    <cell controltype="checkbox" entitylink="fecharpendencia">
                    </cell>
                </row>
            </headerform>
        </layout>
    </form>
  </forms>
  <actions>
    <action form="default">
      <name>retrieve</name>
    </action>
    <action form="default">
      <name>Insert</name>
      <api>
        <name>atcpendenciaNovo_v5</name>
        <fromto valueapi="texto" valueentity="texto"/>
        <fromto valueapi="negociopendencialista" valueentity="negociopendencialista"/>
        <fromto valueapi="created_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="negocio" valueentity="negocio"/>
        <fromto valueapi="impeditivo" valueentity="impeditivo"/>
        <fromto valueapi="impeditivofornecedor" valueentity="impeditivofornecedor"/>
        <fromto valueapi="impeditivocliente" valueentity="impeditivocliente"/>
        <fromto valueapi="prioridade" valueentity="prioridade"/>
        <fromto valueapi="prazo" valueentity="prazo"/>
        <fromto valueapi="atribuidoamim" valueentity="atribuidoamim"/>
        <fromto valueapi="temponotificaexpiracao" valueentity="temponotificaexpiracao"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
        <fromto valueapi="dataprazopendencia" valueentity="dataprazopendencia"/>
      </api>
    </action> 
    <action form="edit">
      <name>Update</name>
      <api>
        <name>atcpendenciaAlterar_v5</name>
        <fromto valueapi="negociopendencia" valueentity="negociopendencia"/>
        <fromto valueapi="prioridade" valueentity="prioridade"/>
        <fromto valueapi="atribuidoa" valueentity="atribuidoa"/>
        <fromto valueapi="updated_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="prazo" valueentity="prazo"/>
        <fromto valueapi="temponotificaexpiracao" valueentity="temponotificaexpiracao"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
        <fromto valueapi="dataprazopendencia" valueentity="dataprazopendencia"/>
      </api>
    </action>
    <action>
      <name>Delete</name>
      <api>
        <name>atcpendenciaExcluir_v2</name>
        <fromto valueapi="negociopendencia" valueentity="negociopendencia"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="deleted_by" valueentity="logged_user"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api> 
    </action>
    <action>
      <name>Marcar</name>
      <api>
        <name>atcPendenciaRealizada_v3</name>
        <fromto valueapi="negociopendencia" valueentity="negociopendencia"/>
        <fromto valueapi="fechadapor" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api> 
    </action>
    <action>
      <name>Desmarcar</name>
      <api>
        <name>atcPendenciaNaoRealizada_v2</name>
        <fromto valueapi="negociopendencia" valueentity="negociopendencia"/>
        <fromto valueapi="updated_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api> 
    </action>
  </actions>
</nsjusecase>