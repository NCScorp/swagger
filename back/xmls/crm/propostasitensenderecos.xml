<?xml version="1.0" encoding="UTF-8" ?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="propostasitensenderecos" label="propostasitensenderecos" project="crm">
  <entity schema="crm" table="propostasitensenderecos">
    <fieldmodel name="propostaitemendereco" datatype="guid" isid="true" column="propostaitemendereco" />
    <fieldmodel name="propostaitem" datatype="guid" column="propostaitem" useCaseLink="crm\propostasitens" />
    <fieldmodel name="ordem" datatype="integer" column="ordem" />
    <fieldmodel name="enderecomanual" datatype="boolean" notMapped="true" />
    <fieldmodel name="enderecoid" datatype="guid" column="enderecoid" useCaseLink="ns\enderecos" entityJoinType="left" />
    <fieldmodel name="tipologradouro" datatype="string" column="tipologradouro" useCaseLink="ns\tiposlogradouros" entityJoinType="left" />
    <fieldmodel name="pais" datatype="string" column="pais" useCaseLink="ns\paises" entityJoinType="left" />
    <fieldmodel name="ibge" datatype="string" column="ibge" useCaseLink="ns\municipios" entityJoinType="left" />
    <fieldmodel name="logradouro" datatype="string" column="logradouro" />
    <fieldmodel name="numeroendereco" datatype="string" column="numero" />
    <fieldmodel name="complemento" datatype="string" column="complemento" />
    <fieldmodel name="cep" datatype="string" column="cep" />
    <fieldmodel name="bairro" datatype="string" column="bairro" />
    <fieldmodel name="uf" datatype="string" column="uf" />
    <fieldmodel name="cidade" datatype="guid" column="cidade" useCaseLink="ns\cidadesestrangeiras" entityJoinType="left"/>
    <fieldmodel name="created_at" datatype="datetime" column="created_at" />
    <fieldmodel name="created_by" datatype="json" column="created_by" />
    <fieldmodel name="updated_at" datatype="datetime" column="updated_at" />
    <fieldmodel name="updated_by" datatype="json" column="updated_by" />
    <fieldmodel name="tenant" datatype="integer" column="tenant" />
    <fieldmodel name="id_grupoempresarial" datatype="guid" column="grupoempresarial"/>
  </entity>
  <constructors>
    <constructoritem required="true">propostaitem</constructoritem>
    <constructoritem required="true">tenant</constructoritem>
    <constructoritem required="true">id_grupoempresarial</constructoritem>
  </constructors>
  <viewbrowser paginate="true" layout="table" target="builtin" label="Servicos Enderecos">
    <fieldsbrowser>
      <fieldbrowser alias="propostaitemendereco" entitylink="propostaitemendereco" visible="false" isid="true" unique="true" avaliable="true" />
      <fieldbrowser alias="propostaitem" entitylink="propostaitem" visible="false" />
      <fieldbrowser alias="ordem" entitylink="ordem" visible="false" />
      <fieldbrowser alias="enderecomanual" entitylink="enderecomanual" visible="false" />
      <fieldbrowser alias="enderecoid" entitylink="enderecoid" visible="false" />
      <fieldbrowser alias="tipologradouro" entitylink="tipologradouro" visible="false" />
      <fieldbrowser alias="pais" entitylink="pais" visible="false" />
      <fieldbrowser alias="ibge" entitylink="ibge" visible="false" />
      <fieldbrowser alias="logradouro" entitylink="logradouro" visible="false" />
      <fieldbrowser alias="numeroendereco" entitylink="numeroendereco" visible="false" />
      <fieldbrowser alias="complemento" entitylink="complemento" visible="false" />
      <fieldbrowser alias="cep" entitylink="cep" visible="false" />
      <fieldbrowser alias="bairro" entitylink="bairro" visible="false" />
      <fieldbrowser alias="tenant" entitylink="tenant" visible="false" />
    </fieldsbrowser>
  </viewbrowser>
  <forms>
    <form name="default">
      <layout>
        <headerform>
          <row>
            <cell>
              <groupbox>
                <caption text="Ponto A" />
                <row>
                  <cell name="ordem" controltype="textedit" colspan="2" entitylink="ordem" />
                </row>
                <row>
                  <cell name="enderecoid" controltype="lookup" visible="!enderecomanual" label="Endereço" colspan="10" entitylink="enderecoid" fielddetaillookup="{'enderecocompleto':'', 'tipoendereco':'Tipo'}" amountfieldslookup="2">
                    <validates>
                      <validate type="vnull" displaytext="O campo Endereço não pode ser vazio." />
                    </validates>
                  </cell>
                  <cell name="enderecomanual" controltype="checkbox" label="Endereço Manual" colspan="2" entitylink="enderecomanual"></cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="tipologradouro" controltype="lookup" label="Tipo" colspan="12" entitylink="tipologradouro" fielddetaillookup="{'tipologradouro':'Tipo', 'descricao':'Descricao'}" amountfieldslookup="2">
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="logradouro" controltype="textedit" label="Logradouro" colspan="12" entitylink="logradouro">
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="numeroendereco" controltype="textedit" label="Número" colspan="6" entitylink="numeroendereco"></cell>
                  <cell name="complemento" controltype="textedit" label="Complemento" colspan="6" entitylink="complemento"></cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="bairro" controltype="textedit" label="Bairro" colspan="6" entitylink="bairro">
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="pais" controltype="lookup" label="País" colspan="6" entitylink="pais" fielddetaillookup="{'nome':'País'}" amountfieldslookup="1">
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                  <cell name="ibge" visible="pais.pais=='1058'" controltype="lookup" label="Cidade" colspan="6" entitylink="ibge" fielddetaillookup="{'nome':'Nome', 'uf':'UF'}" amountfieldslookup="2">
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                  <cell name="cidade" visible="pais.pais!='1058'" controltype="lookup" label="Cidade" colspan="6" entitylink="cidade" fielddetaillookup="{'nome':'Nome'}" amountfieldslookup="1">  
                    <validates>
                      <validate type="vnull" displaytext="Esse campo não pode ser vazio." />
                    </validates>
                  </cell>
                </row>
                <row readonly="!enderecomanual">
                  <cell name="cep" controltype="textedit" label="CEP" colspan="6" entitylink="cep" />
                  <cell name="uf" controltype="hidden" colspan="6" entitylink="uf" />

                </row>
              </groupbox>
            </cell>
          </row>
        </headerform>
      </layout>
    </form>
  </forms>
  <actions>
    <action>
      <name>Insert</name>
      <api>
        <name>PropostaItemEnderecoNovo_v3</name>
        <fromto valueapi="propostaitem" valueentity="propostaitem" />
        <fromto valueapi="ordem" valueentity="ordem" />
        <fromto valueapi="enderecoid" valueentity="enderecoid" />
        <fromto valueapi="tipologradouro" valueentity="tipologradouro" />
        <fromto valueapi="pais" valueentity="pais" />
        <fromto valueapi="ibge" valueentity="ibge" />
        <fromto valueapi="logradouro" valueentity="logradouro" />
        <fromto valueapi="numeroendereco" valueentity="numeroendereco" />
        <fromto valueapi="complemento" valueentity="complemento" />
        <fromto valueapi="cep" valueentity="cep" />
        <fromto valueapi="bairro" valueentity="bairro" />
        <fromto valueapi="uf" valueentity="uf" />
        <fromto valueapi="cidade" valueentity="cidade" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="created_by" valueentity="logged_user" />
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial" />
      </api>
    </action>
    <action>
      <name>Update</name>
      <api>
        <name>PropostaItemEnderecoAlterar_v3</name>
        <fromto valueapi="propostaitemendereco" valueentity="propostaitemendereco" />
        <fromto valueapi="enderecoid" valueentity="enderecoid" />
        <fromto valueapi="tipologradouro" valueentity="tipologradouro" />
        <fromto valueapi="pais" valueentity="pais" />
        <fromto valueapi="ibge" valueentity="ibge" />
        <fromto valueapi="logradouro" valueentity="logradouro" />
        <fromto valueapi="numeroendereco" valueentity="numeroendereco" />
        <fromto valueapi="complemento" valueentity="complemento" />
        <fromto valueapi="cep" valueentity="cep" />
        <fromto valueapi="bairro" valueentity="bairro" />
        <fromto valueapi="uf" valueentity="uf" />
        <fromto valueapi="cidade" valueentity="cidade" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="updated_by" valueentity="logged_user" />
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial" />
      </api>
    </action>
    <action>
      <name>Delete</name>
      <api>
        <name>PropostaItemEnderecoExcluir_v2</name>
        <fromto valueapi="propostaitemendereco" valueentity="propostaitemendereco" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial" />
      </api>
    </action>
  </actions>
</nsjusecase>