<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="listadavezconfiguracoes" routeprefix="lista-da-vez-configuracoes" label="listadavezconfiguracoes" project="crm">
    <entity schema="crm" table="listadavezconfiguracoes">
        <!-- ID -->
        <fieldmodel name="listadavezconfiguracao" datatype="guid" isid="true" column="listadavezconfiguracao"/>
        <!-- Construtores -->
        <fieldmodel name="tenant" datatype="integer" column="tenant"/>
        <fieldmodel name="id_grupoempresarial" datatype="guid" column="id_grupoempresarial"/>
        <!-- Relacionamentos com casos de uso -->
        <fieldmodel name="listadavezregra" datatype="guid" column="id_listadavezregra" useCaseLink="crm\listadavezregras" entityJoinType="left"/>
        <fieldmodel name="idlistadavezregravalor" datatype="guid" column="id_listadavezregravalor" useCaseLink="crm\listadavezregrasvalores" entityJoinType="left"/>
        <fieldmodel name="idestado" datatype="string" column="id_estado" useCaseLink="ns\estados" entityJoinType="left"/>
        <fieldmodel name="idnegociooperacao" datatype="guid" column="id_negociooperacao" useCaseLink="crm\negociosoperacoes" entityJoinType="left"/>
        <fieldmodel name="idsegmentoatuacao" datatype="guid" column="id_segmentoatuacao" useCaseLink="crm\segmentosatuacao" entityJoinType="left"/>
        <fieldmodel name="idpai" datatype="guid" column="id_pai" />
        <fieldmodel name="listadavezvendedor" datatype="guid" column="listadavezvendedor" useCaseLink="crm\listadavezvendedores" entityJoinType="left"/>
        <!-- Demais campos -->
        <fieldmodel name="tiporegistro" datatype="integer" column="tiporegistro">
            <options>{"0":"Regra", "1":"Opção", "2":"Fluxo alternativo"}</options>
        </fieldmodel>
        <fieldmodel name="ordem" datatype="integer" column="ordem"/>
        <fieldmodel name="vendedorfixo" datatype="boolean" column="vendedorfixo"/>
        <!-- Dados de log de criação/alteração -->
        <fieldmodel name="created_at" datatype="datetime" column="created_at"/>
        <fieldmodel name="created_by" datatype="json" column="created_by"/>
        <fieldmodel name="updated_at" datatype="datetime" column="updated_at"/>
        <fieldmodel name="updated_by" datatype="json" column="updated_by"/>
        <!-- ID's utilizados nos itens que ainda não foram adicionados no banco -->
        <fieldmodel name="listadavezconfiguracaonovo" datatype="string" notMapped="true" />
        <fieldmodel name="idpainovo" datatype="string" notMapped="true" />
    </entity>
    <constructors>
        <constructoritem>tenant</constructoritem>
        <constructoritem>id_grupoempresarial</constructoritem>
    </constructors>
    <viewbrowser label="Configurações" layout="list" paginate="true" target="window" itemsPerPage="500">
        <fieldsbrowser>
            <fieldbrowser entitylink="listadavezconfiguracao" isid="true"/>
            <fieldbrowser entitylink="listadavezregra"/>
            <fieldbrowser entitylink="idlistadavezregravalor"/>
            <fieldbrowser entitylink="idestado"/>
            <fieldbrowser entitylink="idnegociooperacao"/>
            <fieldbrowser entitylink="idsegmentoatuacao"/>
            <fieldbrowser entitylink="idpai"/>
            <fieldbrowser entitylink="listadavezvendedor"/>
            <fieldbrowser entitylink="tiporegistro"/>
            <fieldbrowser entitylink="ordem"/>
            <fieldbrowser entitylink="vendedorfixo"/>
        </fieldsbrowser>
    </viewbrowser>
    <forms>
        <form name="default">
            <layout>
                <headerform>
                    <row>
                        <cell controltype="hidden" entitylink="listadavezconfiguracao" />
                        <cell controltype="lookup" entitylink="listadavezregra" />
                        <cell controltype="lookup" entitylink="idlistadavezregravalor" />
                        <cell controltype="lookup" entitylink="idestado" />
                        <cell controltype="lookup" entitylink="idnegociooperacao" />
                        <cell controltype="lookup" entitylink="idsegmentoatuacao" />
                        <cell controltype="hidden" entitylink="idpai" />
                        <cell entitylink="tiporegistro" controltype="combobox">
                            <validates>
                                <validate type="vnull" displaytext="O campo Tipo Registro não pode ser vazio"/>
                            </validates>
                        </cell>
                        <cell controltype="number" entitylink="ordem" />
                        <cell controltype="checkbox" entitylink="vendedorfixo" />
                        <cell controltype="lookup" entitylink="listadavezvendedor" />
                        <!-- Ids utilizados caso o item não esteja no banco -->
                        <cell controltype="hidden" entitylink="listadavezconfiguracaonovo" visible="!listadavezconfiguracao">
                            <validates>
                                <validate type="vnull" displaytext="O campo Lista da vez configuração novo não pode ser vazio"/>
                            </validates>
                        </cell>
                        <!-- Ids utilizados caso o pai do item não esteja no banco -->
                        <cell controltype="hidden" entitylink="idpainovo" />
                    </row>
                </headerform>
            </layout>
        </form>
    </forms>
    <actions>
        <action>
            <name>retrieve</name>
        </action>
        <action>
            <name>Insert</name>
            <api>
                <name>listadavezconfiguracaonovo</name>
                <fromto valueapi="tenant" valueentity="tenant"/>
                <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
                <fromto valueapi="listadavezregra" valueentity="listadavezregra"/>
                <fromto valueapi="idlistadavezregravalor" valueentity="idlistadavezregravalor"/>
                <fromto valueapi="idestado" valueentity="idestado"/>
                <fromto valueapi="idnegociooperacao" valueentity="idnegociooperacao"/>
                <fromto valueapi="idsegmentoatuacao" valueentity="idsegmentoatuacao"/>
                <fromto valueapi="idpai" valueentity="idpai"/>
                <fromto valueapi="tiporegistro" valueentity="tiporegistro"/>
                <fromto valueapi="ordem" valueentity="ordem"/>
                <fromto valueapi="vendedorfixo" valueentity="vendedorfixo"/>
                <fromto valueapi="listadavezvendedor" valueentity="listadavezvendedor"/>
                <fromto valueapi="created_by" valueentity="logged_user"/>
            </api>
        </action>
        <action layer="back">
            <name>Update</name>
            <api>
                <name>listadavezconfiguracaoalterar</name>
                <fromto valueapi="listadavezconfiguracao" valueentity="listadavezconfiguracao"/>
                <fromto valueapi="tenant" valueentity="tenant"/>
                <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
                <fromto valueapi="listadavezregra" valueentity="listadavezregra"/>
                <fromto valueapi="idlistadavezregravalor" valueentity="idlistadavezregravalor"/>
                <fromto valueapi="idestado" valueentity="idestado"/>
                <fromto valueapi="idnegociooperacao" valueentity="idnegociooperacao"/>
                <fromto valueapi="idsegmentoatuacao" valueentity="idsegmentoatuacao"/>
                <fromto valueapi="idpai" valueentity="idpai"/>
                <fromto valueapi="tiporegistro" valueentity="tiporegistro"/>
                <fromto valueapi="ordem" valueentity="ordem"/>
                <fromto valueapi="vendedorfixo" valueentity="vendedorfixo"/>
                <fromto valueapi="listadavezvendedor" valueentity="listadavezvendedor"/>
                <fromto valueapi="updated_by" valueentity="logged_user"/>
            </api>
        </action>
        <action layer="back">
            <name>Delete</name>
            <api>
                <name>listadavezconfiguracaoexcluir</name>
                <fromto valueapi="listadavezconfiguracao" valueentity="listadavezconfiguracao"/>
                <fromto valueapi="tenant" valueentity ="tenant"/>
                <fromto valueapi="grupoempresarial" valueentity ="id_grupoempresarial"/>
            </api>
        </action>
    </actions>
</nsjusecase>