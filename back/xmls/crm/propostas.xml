<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="propostas" label="propostas" project="crm" orphan="false">
  <entity schema="crm" table="propostas">
    <fieldmodel name="proposta" datatype="guid" isid="true" column="proposta"/>
    <fieldmodel name="valor" datatype="float"  column="valor"/>
    <fieldmodel name="status" datatype="integer"  column="status">
      <options>{"0":"Novo","1":"Enviado", "2":"Confirmado", "3": "Recusado"}</options>
    </fieldmodel>
    <fieldmodel name="negocio" datatype="guid"  column="negocio"/>
    <fieldmodel name="numero" datatype="integer"  column="numero"/>
    <fieldmodel name="created_at" datatype="datetime"  column="created_at"/>
    <fieldmodel name="created_by" datatype="json"  column="created_by"/>
    <fieldmodel name="updated_at" datatype="datetime"  column="updated_at"/>
    <fieldmodel name="updated_by" datatype="json"  column="updated_by"/>
    <fieldmodel name="tenant" datatype="integer"  column="tenant"/>
    <fieldmodel name="prazo" datatype="integer" notMapped="true" />
    <fieldmodel name="id_grupoempresarial" datatype="guid" column="grupoempresarial"/>
  </entity>
  <constructors>
    <constructoritem>tenant</constructoritem>
    <constructoritem >negocio</constructoritem>
    <constructoritem >id_grupoempresarial</constructoritem>
  </constructors>
  <viewbrowser label="Propostas" layout="table" paginate="true" target="window">
    <fieldsbrowser>
      <fieldbrowser entitylink="proposta" isid="true" visible="false"/>
      <fieldbrowser alias="Valor" entitylink="valor" visible="true" cansearch="false" />
      <fieldbrowser alias="Número" entitylink="numero" visible="true" cansearch="false" />
      <fieldbrowser entitylink="negocio" visible="false" cansearch="false" />
      <fieldbrowser alias="Última Atualização" entitylink="updated_at" visible="true" cansearch="false" indefaultorder="true"/>
      <fieldbrowser alias="Status" style="label" entitylink="status" />
      <fieldbrowser entitylink="prazo" visible="false" cansearch="false" />
    </fieldsbrowser>
  </viewbrowser>
  <forms>
    <form name="default" label="Pedido">
      <layout>
        <headerform>
          <row>
            <cell controltype="textedit" label="Número" colspan="4" entitylink="numero" readonly="true" visible="numero"/>
          </row>
          <row>
            <cell controltype="money" label="Valor" colspan="4" entitylink="valor"/>
          </row>
        </headerform>
      </layout>
    </form>
  </forms>
  <actions>
    <action form="default">
      <name>retrieve</name>
    </action>
    <action form="default">
      <name>Insert</name>
      <api>
        <!-- Ao versionar essa função, versionar também em atcs.xml, no insert -->
        <name>propostaNovo_v2</name>
        <fromto valueapi="negocio" valueentity="negocio"/>
        <fromto valueapi="created_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api>
    </action>
    <action form="default">
      <name>Update</name>
      <api>
        <name>propostaAlterar_v2</name>
        <fromto valueapi="proposta" valueentity="proposta"/>
        <fromto valueapi="valor" valueentity="valor"/>
        <fromto valueapi="updated_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api>
    </action>
  </actions>
</nsjusecase>