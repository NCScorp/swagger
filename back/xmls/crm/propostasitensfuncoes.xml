<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="propostasitensfuncoes" label="propostasitensfuncoes" project="crm">
  <entity schema="crm" table="propostasitensfuncoes">
    <fieldmodel name="propostaitemfuncao" datatype="guid" isid="true" column="propostaitemfuncao"/>
    <fieldmodel name="propostaitem" datatype="guid" column="propostaitem"/>
    <fieldmodel name="funcao" datatype="guid" column="funcao" useCaseLink="gp\funcoes" entityJoinType="left"/>
    <fieldmodel name="quantidade" datatype="integer" column="quantidade"/>
    <fieldmodel name="valor" datatype="moeda" column="valor"/>
    <fieldmodel name="created_at" datatype="datetime" column="created_at"/>
    <fieldmodel name="created_by" datatype="json" column="created_by"/>
    <fieldmodel name="tenant" datatype="integer" column="tenant"/>
    <fieldmodel name="composicaofuncao" datatype="guid" column="composicaofuncao"/>
    <fieldmodel name="composicao" datatype="guid" column="composicao"/>
    <fieldmodel name="itemcontrato" datatype="guid" column="itemcontrato" useCaseLink="financas\itenscontratos" entityJoinType="left"/>
    <fieldmodel name="itemcontratoAPagar" datatype="guid" column="itemcontratoAPagar" useCaseLink="financas\itenscontratos" entityJoinType="left"/>
    <fieldmodel name="templateproposta" datatype="guid" column="templateproposta" useCaseLink="crm\templatespropostas" entityJoinType="left"/>
    <fieldmodel name="templatepropostacomposicaofuncao" datatype="guid" column="templatepropostacomposicaofuncao" useCaseLink="crm\templatescomposicoesfuncoes" entityJoinType="left"/>
    <fieldmodel name="contrato" datatype="string" notMapped="true"></fieldmodel>
    <fieldmodel name="id_grupoempresarial" datatype="guid" column="grupoempresarial"/>
    <fieldmodel name="nome" datatype="string"  column="nome" />
    <fieldmodel name="nomefuncaoalterado" datatype="boolean" column="nomefuncaoalterado"/>
  </entity>
  <constructors>
    <constructoritem required="true">tenant</constructoritem>
    <constructoritem required="true">propostaitem</constructoritem>
    <constructoritem required="true">id_grupoempresarial</constructoritem>
  </constructors>
  <viewbrowser paginate="true" layout="list" target="window" label="Proposta Item Função">
    <fieldsbrowser>
      <fieldbrowser entitylink="propostaitemfuncao" visible="false" isid="true"/>
      <fieldbrowser entitylink="quantidade" visible="true" cansearch="true"/>
      <fieldbrowser entitylink="propostaitem" visible="true" cansearch="true"/>
      <fieldbrowser alias="funcao" entitylink="funcao" visible="true" fielddetaillookup="{'descricao':'Descrição','codigo':'Código'}" avaliable="true"/>
      <fieldbrowser entitylink="itemcontrato" visible="false" />
      <fieldbrowser entitylink="itemcontratoAPagar" visible="false" />
      <fieldbrowser entitylink="templateproposta" visible="false" />
      <fieldbrowser entitylink="templatepropostacomposicaofuncao" visible="false" />
      <fieldbrowser entitylink="contrato" visible="false" cansearch="false" />
      <fieldbrowser entitylink="nome" visible="true" cansearch="false"/>
      <fieldbrowser entitylink="nomefuncaoalterado" visible="true" cansearch="false"/>
    </fieldsbrowser>
  </viewbrowser>
  <forms>
    <form name="default" label="Vincular item da proposta a função">
      <layout>
        <headerform>
          <row>
            <cell>
              <groupbox>
                <row>
                  <cell name="funcao" controltype="lookup" label="Função" colspan="12" entitylink="funcao" fielddetaillookup="{'descricao':'Descrição','codigo':'Código'}">
                    <validates>
                      <validate type="vnull" displaytext="O campo função não pode ser vazio."/>
                    </validates>
                  </cell>
                  <cell name="quantidade" controltype="number" label="Quantidade" colspan="4" entitylink="quantidade">
                    <validates>
                      <validate type="vnull" displaytext="O campo quantidade não pode ser vazio"/>
                      <validate type="greaterthan" value="0" displaytext="A quantidade deve ser maior que 0."/>
                    </validates>
                  </cell>
                </row>
                <row>
                  <cell controltype="textedit" label="Descrição" colspan="12" entitylink="nome">
                    <validates>
                      <validate type="maxlength" value="150" displaytext="O campo Nome aceita no máximo 150 caracteres"/>
                    </validates>
                  </cell>
                  <cell label="Nome Função Alterado" controltype="checkbox" entitylink="nomefuncaoalterado" colspan="12" />
                </row>
              </groupbox>
            </cell>
          </row>
        </headerform>
      </layout>
    </form> 
    <form name="edicao" label="Editar item da proposta a função">
      <layout>
        <headerform>
          <row>
            <cell name="quantidade" label="Quantidade" controltype="number" colspan="6" entitylink="quantidade"/>   
          </row>
          <row>
            <cell controltype="textedit" label="Descrição" colspan="12" entitylink="nome">
              <validates>
                <validate type="maxlength" value="150" displaytext="O campo Nome aceita no máximo 150 caracteres"/>
              </validates>
            </cell>
            <cell label="Nome Função Alterado" controltype="checkbox" entitylink="nomefuncaoalterado" colspan="12" />
          </row>
        </headerform>
      </layout>
    </form>
  </forms>
  <actions>
    <action>
      <name>Retrieve</name>
    </action>
    <action>
      <name>Insert</name>
      <api>
        <name>propostaItemFuncaoNovo_v3</name>
        <fromto valueapi="propostaitem" valueentity="propostaitem"/>
        <fromto valueapi="funcao" valueentity="funcao"/>
        <fromto valueapi="quantidade" valueentity="quantidade"/>
        <fromto valueapi="valor" valueentity="valor"/>
        <fromto valueapi="created_by" valueentity="logged_user"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
        <fromto valueapi="nome" valueentity="nome"/>
        <fromto valueapi="nomefuncaoalterado" valueentity="nomefuncaoalterado"/>
      </api>
    </action>
    <action form="edicao">
      <name>Update</name>
      <api>
        <name>propostaItemFuncaoAlterar_v3</name>
        <fromto valueapi="propostaitemfuncao" valueentity="propostaitemfuncao"/>
        <fromto valueapi="propostaitem" valueentity="propostaitem"/>
        <fromto valueapi="funcao" valueentity="funcao"/>
        <fromto valueapi="quantidade" valueentity="quantidade"/>
        <fromto valueapi="valor" valueentity="valor"/>
        <fromto valueapi="tenant" valueentity="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
        <fromto valueapi="nome" valueentity="nome"/>
        <fromto valueapi="nomefuncaoalterado" valueentity="nomefuncaoalterado"/>
        <fromto valueapi="updated_by" valueentity="logged_user"/>
      </api>
    </action>
    <action>
      <name>Delete</name>
      <api>
        <name>propostaItemFuncaoExcluir_v3</name>
        <fromto valueapi="propostaitemfuncao" valueentity="propostaitemfuncao"/>
        <fromto valueapi="tenant" valueentity ="tenant"/>
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
        <fromto valueapi="deleted_by" valueentity="logged_user"/>
        <fromto valueapi="propostaitem" valueentity="propostaitem"/>
      </api>
    </action>
    <action layer="back">
      <name>editaItemContratoNaPropostaItemFuncao</name>
      <api>
        <name>editaItemContratoNaPropostaItemFuncao_v2</name>
        <fromto valueapi="propostaitemfuncao" valueentity="propostaitemfuncao" />
        <fromto valueapi="itemcontrato" valueentity="itemcontrato" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api>
    </action>
    <action layer="back">
      <name>editaItemContratoAPagarNaPropostaItemFuncao</name>
      <api>
        <name>editaItemContratoAPagarNaPropostaItemFuncao_v2</name>
        <fromto valueapi="propostaitemfuncao" valueentity="propostaitemfuncao" />
        <fromto valueapi="itemcontratoAPagar" valueentity="itemcontratoAPagar" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
      </api>
    </action>
  </actions>
</nsjusecase>