<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="clientes" label="clientes" project="ns">
    <entity schema="ns" table="vw_clientes_v3">
        <fieldmodel name="cliente" datatype="guid" isid="true" column="cliente"/>
        <fieldmodel name="codigo" datatype="string"  column="pessoa"/>
        <fieldmodel name="razaosocial" datatype="string"  column="nome"/>
        <fieldmodel name="nomefantasia" datatype="string"  column="nomefantasia"/>
        <fieldmodel name="identidade" notMapped="true" />
        <fieldmodel name="documento" notMapped="true"/>
        <!-- Testado com a view alterada no banco com a adição do grupo empresarial, usando o grupo empresarial como construtor -->
        <fieldmodel name="id_grupoempresarial" datatype="guid" column="id_grupoempresarial"/>
        <fieldmodel name="cnpj" datatype="string"  column="cnpj"/>
        <fieldmodel name="realizapagamentoempresas" datatype="boolean"  column="realizapagamentoempresas"/>
        <fieldmodel name="inscricaomunicipal" datatype="string"  column="inscricaomunicipal"/>
        <fieldmodel name="endereco" datatype="objectlist"  column="id_pessoa" useCaseLink="ns\enderecos" entityJoinType="left"/>
        <fieldmodel name="created_at" datatype="datetime"  column="created_at"/>
        <fieldmodel name="created_at" datatype="datetime"  column="created_at"/>
        <fieldmodel name="created_by" datatype="json"  column="created_by"/>
        <fieldmodel name="updated_at" datatype="datetime"  column="updated_at"/>
        <fieldmodel name="updated_by" datatype="json"  column="updated_by"/>
        <fieldmodel name="diasparavencimento" datatype="integer"  column="diasparavencimento"/>
        <fieldmodel name="tenant" datatype="integer"  column="tenant"/>
        <fieldmodel name="contatos" datatype="objectlist" column="pessoa" useCaseLink="ns\contatos" entityJoinType="left"/>
        <fieldmodel name="tiposatividades" datatype="objectlist"  column="pessoa" useCaseLink="ns\pessoastiposatividades" entityJoinType="left"/>
        <fieldmodel name="tiposatividadesfilter" datatype="guid" notMapped="true"  useCaseLink="ns\tiposatividades" entityJoinType="left"/>
        <fieldmodel name="id_pessoa" datatype="guid" notMapped="true"  useCaseLink="ns\enderecos" entityJoinType="left"/>
        <fieldmodel name="templates" datatype="objectlist" column="cliente"  useCaseLink="crm\templatespropostasgrupos" entityJoinType="left"/>
        <fieldmodel name="clientesdocumentos" datatype="objectlist" column="cliente" useCaseLink="ns\clientesdocumentos" entityJoinType="left"/>
        <fieldmodel name="cadastro" datatype="integer" notMapped="true">
            <options> {"1":"CNPJ","2":"CPF"} </options>
        </fieldmodel>
        <fieldmodel name="cpf" datatype="textedit" notMapped="true"/>
        <fieldmodel name="tipo" datatype="integer" column="tipo"/>
        <fieldmodel name="formapagamento" datatype="guid" column="formapagamento" useCaseLink="ns\formaspagamentos" entityJoinType="left"/>
        <fieldmodel name="formapagamentoguid" datatype="guid" column="formapagamento"/>
        <fieldmodel name="seguradora" datatype="boolean" column="seguradora"/>
        <fieldmodel name="anotacao" datatype="string" column="anotacao"/>
        <fieldmodel name="vendedor" datatype="guid" column="vendedor" useCaseLink="ns\vendedores" entityJoinType="left"/>
        <fieldmodel name="clientesanexo" datatype="objectlist" column="clientesanexo" useCaseLink="ns\clientesanexos" entityJoinType="left" />
        <fieldmodel name="conta" column="conta" datatype="guid" useCaseLink="financas\contas" entityJoinType="left" />
    </entity>
    <constructors>
      <constructoritem>tenant</constructoritem>
      <constructoritem>id_grupoempresarial</constructoritem>
    </constructors>
    <viewbrowser label="Clientes" layout="list" paginate="true" target="builtin">
      <filters>
          <fieldsfilters>
              <fieldfilter entitylink="tipo"  maxoccurs='unbounded' visible="true">
                <conditions>
                       <condition type="eq"/>
                   </conditions>
              </fieldfilter>
              <fieldfilter entitylink="tiposatividadesfilter"  maxoccurs='unbounded' >
                <lookup fielddetail="{'nome':'Nome'}" allowinsert="false" />
                   <conditions>
                       <condition type="eq"/>
                   </conditions>
              </fieldfilter>
              <fieldfilter entitylink="cnpj"  maxoccurs='unbounded' visible="false">
                   <conditions>
                       <condition type="eq"/>
                   </conditions>
              </fieldfilter>
              <!-- <fieldfilter entitylink="id_pessoa"  maxoccurs='unbounded' >
                <lookup fielddetail="{'nome':'Nome'}" allowinsert="false" />
                   <conditions>
                       <condition type="eq"/>
                   </conditions>
              </fieldfilter> -->
          </fieldsfilters>
        </filters>
        <fieldsbrowser>
            <fieldbrowser entitylink="cliente" isid="true" visible="false"/>
            <fieldbrowser entitylink="razaosocial" visible="false"/>
            <fieldbrowser entitylink="cpf" visible="false"/>
            <fieldbrowser alias="Nome Fantasia" entitylink="nomefantasia" visible="true" cansearch="true" indefaultorder="true"/>
            <fieldbrowser alias="Documento" entitylink="cnpj" visible="true"/>
            <fieldbrowser entitylink="diasparavencimento" visible="false" cansearch="false" />
            <!-- <fieldbrowser alias="Municipio" entitylink="municipio" visible="true"  fielddetaillookup="{'nome': 'Municipio'}" /> -->
            <fieldbrowser entitylink="tiposatividadesfilter" visible="false" cansearch="false" fielddetaillookup="{'nome': 'Nome'}" />
            <fieldbrowser entitylink="id_pessoa" visible="false" cansearch="false" fielddetaillookup="{'nome': 'Nome'}"/>
            <fieldbrowser entitylink="tipo" visible="false" cansearch="true"/>
            <fieldbrowser entitylink="formapagamento" visible="false" cansearch="false" fielddetaillookup="{'descricao': 'Nome'}"/>
            <fieldbrowser entitylink="formapagamentoguid" visible="false"/>
            <!-- <fieldbrowser entitylink="seguradora" visible="false"/> -->
            <fieldbrowser alias="Anotação" entitylink="anotacao" visible="false"/>
            <fieldbrowser entitylink="codigo" visible="false"/>
            <fieldbrowser entitylink="vendedor" visible="false" cansearch="false" fielddetaillookup="{'vendedor_nome': 'Nome'}" />
            <fieldbrowser entitylink="conta" visible="false"/>
        </fieldsbrowser>
    </viewbrowser>
    <forms>
      <form name="default" label="Cliente">
          <layout>
              <bodyform>
                <tabs>
                  <tab caption="Dados Gerais">
                    <row>
                      <cell>
                        <groupbox>
                          <caption text="Dados básicos"></caption>
                          <row>
                            <cell name="nomefantasia" controltype="textedit" label="Nome Fantasia" colspan="6" entitylink="nomefantasia">
                              <validates>
                                <validate type="maxlength" value="150" displaytext="O campo Nome Fantasia aceita no máximo 150 caracteres"/>
                                <validate type="vnull" displaytext="O campo Nome Fantasia não pode ser vazio"/>
                              </validates>
                            </cell>
                            <cell name="razaosocial" controltype="textedit" label="Razão Social" colspan="6" entitylink="razaosocial" readonly="cliente">
                              <validates>
                                <validate type="maxlength" value="150" displaytext="O campo Razão Social aceita no máximo 150 caracteres"/>
                                <validate type="vnull" displaytext="O campo Razão Social não pode ser vazio"/>
                              </validates>
                            </cell>
                          </row>
                          <row>
                            <cell name="codigo" controltype="textedit" label="Código" colspan="6" entitylink="codigo" readonly="cliente">
                              <validates>
                                <validate type="maxlength" value="30" displaytext="O campo Código aceita no máximo 30 caracteres"/>
                                <validate type="vnull" displaytext="O campo Código não pode ser vazio"/>
                              </validates>
                            </cell>
                            <cell name="cadastro" controltype="combobox" label="Cadastro" colspan="6" entitylink="cadastro" visible="cadastro != 3" readonly="cliente">
                              <validates>
                                <validate type="vnull" displaytext="O campo cadastro não pode ser vazio"/>
                              </validates>
                            </cell>                    
                            <cell controltype="cpf" colspan="6" entitylink="cpf" label="CPF" readonly="cadastro == 1 || cadastro == null" >
                             <validates>
                                <validate type="maxlength" value="11" displaytext="O campo CPF aceita no máximo 11 caracteres"/>
                                <validate type="vnull" displaytext="O campo CPF não pode ser vazio"/>
                              </validates>
                              </cell>
                            <cell name="cnpj" controltype="cnpj" label="CNPJ" colspan="6" entitylink="cnpj" readonly="cadastro == 2 || cadastro == null"> 
                              <validates>
                                <validate type="maxlength" value="14" displaytext="O campo CNPJ aceita no máximo 14 caracteres"/>
                                <!--<validate type="unique"  displaytext="Esse cnpj já foi cadastrado"/>-->
                                <validate type="vnull" displaytext="O campo CNPJ não pode ser vazio"/>
                              </validates>
                            </cell>
                            <cell name="inscricaomunicipal" controltype="textedit" label="Inscrição Municipal" colspan="6" entitylink="inscricaomunicipal">
                              <validates>
                                <validate type="maxlength" value="20" displaytext="O campo Inscrição Municipal aceita no máximo 20 caracteres"/>
                              </validates>
                            </cell>
                            <cell name="formapagamento" controltype="lookup" label="Forma de Pagamento Padrão" colspan="6" entitylink="formapagamento" fielddetaillookup="{'descricao':'Descrição'}" amountfieldslookup="1"/>
                          </row>
                        </groupbox>
                      </cell>
                    </row>
                    <row>
                        <cell name="realizapagamentoempresas" controltype="checkbox" label="Seguradora realiza pagamento a empresas" colspan="12" entitylink="realizapagamentoempresas" />
                    </row>
                    <row>
                      <cell label="Seguradora?" name="seguradora" controltype="checkbox" entitylink="seguradora" />
                    </row>
                  </tab>
                  <tab caption="Contatos">
                    <row>
                      <cell colspan="12" name="contatos" controltype="objectlist" entitylink="contatos" label="Contato"/>
                    </row>
                  </tab>
                  <tab caption="Endereços">
                    <row>
                      <cell colspan="12" name="endereco" controltype="objectlist" entitylink="endereco" label="Endereço"/>
                    </row>
                  </tab>
                  <tab caption="Dados Bancários">
                    <row>
                      <!-- Validação para não fazer o envio do formulário com valores inválidos nos arquivos new.ts e edit.ts sobrescritos -->
                      <cell colspan="6"  controltype="number" entitylink="diasparavencimento" label="Vencimento do pagamento em:"/>
                    </row>
                  </tab>
                  <tab caption="Tipos de Atividade">
                    <row>
                      <cell colspan="12" name="tiposatividades" controltype="objectlist" entitylink="tiposatividades" label="Tipos Atividades"/>
                    </row>
                  </tab>
                  
                  <tab caption="Documentos">
                      <row>
                          <cell colspan="12" name="clientesdocumentos" controltype="objectlist" entitylink="clientesdocumentos" />
                      </row>
                  </tab>
                  <tab caption="Anotações">
                      <row>
                        <cell name="anotacao" controltype="textarea" colspan="12" entitylink="anotacao" />
                      </row>
                  </tab>
                    <tab caption="Conta">
                        <row>
                            <cell name="conta" entitylink="conta" colspan="4" controltype="lookup" label="Conta"  fielddetaillookup="nome" />
                        </row>
                    </tab>
                </tabs>
              </bodyform>
          </layout>
      </form>
      <form name="show" label="Cliente">
          <layout>
              <bodyform>
                <tabs>
                  <tab caption="Dados Gerais">
                    <row>
                      <cell>
                        <groupbox>
                          <caption text="Dados básicos"></caption>
                          <row>
                            <cell name="nomefantasia" controltype="textedit" label="Nome Fantasia" colspan="6" entitylink="nomefantasia" />
                            <cell name="razaosocial" controltype="textedit" label="Razão Social" colspan="6" entitylink="razaosocial" readonly="cliente" />
                          </row>
                          <row>
                            <cell name="codigo" controltype="textedit" label="Código" colspan="6" entitylink="codigo" readonly="cliente" />
                            <cell name="cnpj" controltype="cnpj" label="CNPJ" colspan="6" entitylink="cnpj" readonly="cliente" />
                          </row>
                          <row> 
                            <cell name="inscricaomunicipal" controltype="textedit" label="Inscrição Municipal" colspan="6" entitylink="inscricaomunicipal" />
                            <cell name="formapagamento" controltype="lookup" label="Forma de Pagamento Padrão" colspan="6" entitylink="formapagamento" fielddetaillookup="{'descricao':'Descrição'}" amountfieldslookup="1"/>
                          </row>
                        </groupbox>
                      </cell>
                    </row>
                    <row>
                    </row>
                    <row>
                      <cell>
                         <groupbox>
                             <row>
                               <cell label="Seguradora realiza pagamento a empresas" name="realizapagamentoempresas" controltype="checkbox" entitylink="realizapagamentoempresas" />
                             </row>
                         </groupbox>
                      </cell>
                    </row>
                    <row>
                      <cell label="Seguradora?" name="seguradora" controltype="checkbox" entitylink="seguradora" />
                    </row>
                  </tab>
                  <tab caption="Contatos">
                    <row>
                      <cell colspan="12" name="contatos" controltype="objectlist" entitylink="contatos" label="Contato"/>
                    </row>
                  </tab>
                   <tab caption="Endereços">
                    <row>
                      <cell colspan="12" name="endereco" controltype="objectlist" entitylink="endereco" label="Endereço"/>
                    </row>
                  </tab>
                  <tab caption="Dados Bancários">
<!--                    <row>
                      <cell colspan="12" name="faturanamatriz" controltype="checkbox" entitylink="faturanamatriz" label="Fatura na Matriz"/>
                    </row> -->
                  <row>
                    <cell colspan="6"  controltype="number" entitylink="diasparavencimento" label="Vencimento do pagamento em:"/>
                  </row>
                  </tab>
                  <tab caption="Tipos de Atividade">
                    <row>
                      <cell colspan="12" name="tiposatividades" controltype="objectlist" entitylink="tiposatividades" label="Tipos Atividades"/>
                    </row>
                  </tab>
                  <tab caption="Template de Apólices">
                    <row>
                      <cell colspan="12" controltype="objectlist" entitylink="templates" />
                    </row>
                  </tab>
                  <tab caption="Documentos">
                      <row>
                          <cell colspan="12" controltype="objectlist" entitylink="clientesdocumentos" />
                      </row>
                  </tab>
                  <tab caption="Anotações">
                    <row>
                      <cell name="anotacao" controltype="textarea" colspan="12" entitylink="anotacao" />
                    </row>
                  </tab>
                </tabs>
              </bodyform>
          </layout>
      </form>
    </forms>
    <actions>
        <action form="show">
          <name>Retrieve</name>
        </action>
        <action successMsg="O Cliente foi criado com sucesso!" failMsg="Ocorreu um erro ao criar o Cliente!">
            <name>Insert</name>
            <api>
                <name>clienteNovo_v6</name>
                <fromto valueapi="codigo" valueentity="codigo"/>
                <fromto valueapi="nome" valueentity="razaosocial"/>
                <fromto valueapi="nomefantasia" valueentity="nomefantasia"/>
                <fromto valueapi="identidade" valueentity="identidade"/>
                <fromto valueapi="documento" valueentity="documento"/>
                <fromto valueapi="cnpj" valueentity="cnpj"/>
                <fromto valueapi="inscricaomunicipal" valueentity="inscricaomunicipal"/>
                <fromto valueapi="realizapagamentoempresas" valueentity="realizapagamentoempresas"/>
                <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
                <fromto valueapi="created_by" valueentity="logged_user"/>
                <fromto valueapi="tenant" valueentity="tenant"/>
                <fromto valueapi="diasparavencimento" valueentity="diasparavencimento"/>
                <fromto valueapi="contatos" valueentity="contatos"/>
                <fromto valueapi="tiposatividades" valueentity="tiposatividades"/>
                <fromto valueapi="templates" valueentity="templates"/>
                <fromto valueapi="clientesdocumentos" valueentity="clientesdocumentos"/>
                <fromto valueapi="endereco" valueentity="endereco"/> 
                <fromto valueapi="formapagamento" valueentity="formapagamento"/>
                <fromto valueapi="seguradora" valueentity="seguradora"/>
                <fromto valueapi="anotacao" valueentity="anotacao"/>
                <fromto valueapi="conta" valueentity="conta"/>
            </api>
        </action>
        <action form="default" successMsg="O Cliente foi editado com sucesso!" failMsg="Ocorreu um erro ao editar o Cliente!">
            <name>Update</name>
            <api>
                <name>clienteAlterar_v7</name>
                <fromto valueapi="cliente" valueentity="cliente"/>
                <fromto valueapi="nomefantasia" valueentity="nomefantasia"/>
                <fromto valueapi="identidade" valueentity="identidade"/>
                <fromto valueapi="inscricaomunicipal" valueentity="inscricaomunicipal"/>
                <fromto valueapi="realizapagamentoempresas" valueentity="realizapagamentoempresas"/>
                <fromto valueapi="updated_by" valueentity="logged_user"/>
                <fromto valueapi="tenant" valueentity="tenant"/>
                <fromto valueapi="diasparavencimento" valueentity="diasparavencimento"/>
                <fromto valueapi="contatos" valueentity="contatos"/>
                <fromto valueapi="tiposatividades" valueentity="tiposatividades"/>
                <fromto valueapi="templates" valueentity="templates"/>
                <fromto valueapi="clientesdocumentos" valueentity="clientesdocumentos"/>
                <fromto valueapi="endereco" valueentity="endereco"/> 
                <fromto valueapi="formapagamento" valueentity="formapagamento"/>
                <fromto valueapi="seguradora" valueentity="seguradora"/>
                <fromto valueapi="anotacao" valueentity="anotacao"/> 
                <fromto valueapi="conta" valueentity="conta"/>
                <fromto valueapi="grupoempresarial" valueentity="id_grupoempresarial"/>
            </api>
        </action>
    </actions>
</nsjusecase>
