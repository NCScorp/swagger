<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="advertencias" label="advertencias" project="ns">
    <entity schema="ns" table="advertencias"> 
        <!--
          Atenção:
          ao realizar alterações neste model, por favor conferir o arquivo 
          AppBundle/Repository/Crm/NegociosRepository.php
          e fazer as devidas modificações (pois o repository foi sobrescrito)
        -->
        <fieldmodel name="advertencia" datatype="guid" isid="true" column="advertencia"/> 
        <fieldmodel name="fornecedor" datatype="guid" column="fornecedor_id"/>
        <fieldmodel name="motivo" datatype="string" column="motivo"/>
        <fieldmodel name="status" datatype="integer" column="status">
            <options> {"0":"Em vigor","1":"Arquivada","2":"Excluída"} </options>
        </fieldmodel>
        <fieldmodel name="created_at" datatype="datetime" column="created_at" /> 
        <fieldmodel name="created_by" datatype="json" column="created_by"/>  
        <fieldmodel name="tenant" datatype="integer" column="tenant"/>
        <fieldmodel name="fornecedores" datatype="guid" column="fornecedor_id" useCaseLink="ns\fornecedores" entityJoinType="left"/>
        <fieldmodel name="estabelecimento" datatype="guid" column="estabelecimento" useCaseLink="ns\estabelecimentos" entityJoinType="left"/>
        <fieldmodel name="motivoremocao" datatype="string" notMapped="true" />
        <fieldmodel name="nome" datatype="string" column="nome" />
        <fieldmodel name="id_grupoempresarial" datatype="guid" column="id_grupoempresarial"/>
    </entity>
    <constructors>
        <constructoritem required="true">tenant</constructoritem>
         <constructoritem required="true">id_grupoempresarial</constructoritem>
    </constructors>
    <viewbrowser label="Advertências" layout="list" paginate="true" target="builtin">
        <filters style="fixed">
          <fieldsfilters>
              <fieldfilter entitylink="fornecedores" required="true"  maxoccurs='unbounded'>
                <lookup fielddetail="{'nomefantasia':'Nome'}" allowinsert="false" />
                   <conditions>
                       <condition type="eq"/>
                   </conditions>
              </fieldfilter>
          </fieldsfilters>
        </filters>
        <fieldsbrowser>
            <fieldbrowser entitylink="advertencia" isid="true" visible="false" />
            <fieldbrowser entitylink="fornecedor" visible="false" />
            <fieldbrowser entitylink="nome" visible="true" alias="Nome da Advertência"/>
            <fieldbrowser entitylink="fornecedores" visible="false"  fielddetaillookup="{'nomefantasia': 'Prestadora'}"/>
            <fieldbrowser entitylink="created_at" alias="Data" visible="true" indefaultorder="true" direction="DESC"/>
            <fieldbrowser entitylink="motivo" alias="Motivo" visible="true" />
            <fieldbrowser entitylink="status" alias="Status" visible="true" />
            <fieldbrowser entitylink="id_grupoempresarial" visible="false" />
            <fieldbrowser entitylink="estabelecimento" visible="false"  fielddetaillookup="{'nomefantasia': 'Nome'}"/>
        </fieldsbrowser>
     </viewbrowser>
     <forms>
         <form name="show" label="Advertência">
            <layout>
                <headerform>
                    <row>
                      <cell label="Nome" colspan="12" name="nome" controltype="textedit" entitylink="nome" />
                    </row>
                    <row>
                      <cell label="Data" colspan="12" name="created_at" controltype="dateedit" entitylink="created_at"/>
                    </row>
                    <row>
                      <cell label="Motivo" colspan="12" name="motivo" controltype="textedit" entitylink="motivo"/>
                    </row>
                    <row>
                        <cell label="Status" colspan="12" name="status" controltype="combobox" entitylink="status"/>
                    </row>
                    <row>
                        <cell label="Estabelecimento" entitylink="estabelecimento" controltype="lookup" colspan="6" fielddetaillookup="{'nomefantasia':'Nome'}" amountfieldslookup="1"/>
                    </row>
                </headerform>
            </layout> 
         </form>
         <form name="arquivar" label="Arquivar advertência">
          <layout>
              <headerform>
                  <row>
                      <cell name="motivoremocao" entitylink="motivoremocao" colspan="12" label="Motivo" controltype="textarea">
                        <validates>
                          <validate type="vnull" displaytext="O campo não pode estar vazio."/>
                        </validates>
                      </cell>
                  </row>
              </headerform>
          </layout>
        </form>
        <form name="excluir" label="Excluir advertência">
          <layout>
              <headerform>
                  <row>
                      <cell name="motivoremocao" entitylink="motivoremocao" colspan="12" label="Motivo" controltype="textarea">
                        <validates>
                          <validate type="vnull" displaytext="O campo não pode estar vazio."/>
                        </validates>
                      </cell>
                  </row>
              </headerform>
          </layout>
        </form>
     </forms>
     <actions>
         <action form="show">
          <name>retrieve</name>
         </action>
         <!-- Label dos botões definidas no show.html.twig sobrescrito -->
         <action form="arquivar" disable="status!=0" appendto="view" label="" color="blue" icon="none" method="post" successMsg="Advertência arquivada com sucesso" failMsg="Erro ao tentar arquivar advertência" >
            <name>Arquivar</name>
            <api>
                <name>advertenciaarquivar</name>
                <fromto valueapi="advertencia" valueentity="advertencia" />
                <fromto valueapi="nome" valueentity="nome"/>  
                <fromto valueapi="motivo" valueentity="motivoremocao" />  
                <fromto valueapi="tenant" valueentity="tenant" />  
                <fromto valueapi="created_by" valueentity="created_by" />  
            </api>
        </action>
        <action form="excluir" disable="status!=0" appendto="view" label="" color="red" icon="none" method="post" successMsg="Advertência excluída com sucesso" failMsg="Erro ao tentar excluir advertência" >
            <name>Excluir</name>
            <api>
                <name>advertenciaexcluir</name>
                <fromto valueapi="advertencia" valueentity="advertencia" />
                <fromto valueapi="nome" valueentity="nome" />  
                <fromto valueapi="motivo" valueentity="motivoremocao" />  
                <fromto valueapi="tenant" valueentity="tenant" /> 
                <fromto valueapi="created_by" valueentity="created_by" /> 
            </api>
        </action>
     </actions>
</nsjusecase>
