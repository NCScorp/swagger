<?xml version="1.0" encoding="UTF-8" ?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="prospects" label="prospects" project="ns">
  <entity schema="ns" table="vw_prospects">
    <fieldmodel name="prospect" datatype="guid" isid="true" column="prospect"/>
    <fieldmodel name="codigo" datatype="string"  column="pessoa"/>
    <fieldmodel name="razaosocial" datatype="string"  column="nome"/>
    <fieldmodel name="nomefantasia" datatype="string"  column="nomefantasia"/>
    <fieldmodel name="id_grupoempresarial" datatype="guid" column="id_grupoempresarial"/>
    <fieldmodel name="cnpj" datatype="string"  column="cnpj"/>
    <fieldmodel name="created_at" datatype="datetime"  column="created_at"/>
    <fieldmodel name="created_by" datatype="json"  column="created_by"/>
    <fieldmodel name="tenant" datatype="integer"  column="tenant"/>
    <fieldmodel name="contatos" datatype="objectlist" column="pessoa" useCaseLink="ns\contatos" entityJoinType="left"/>
    <fieldmodel name="segmentoatuacao" datatype="guid" column="segmentoatuacao" useCaseLink="crm\segmentosatuacao" entityJoinType="left"/>
  </entity>
  <constructors>
    <constructoritem>tenant</constructoritem>
    <constructoritem>id_grupoempresarial</constructoritem>
  </constructors>
  <viewbrowser label="Prospects" layout="table" >
    <fieldsbrowser>
      <fieldbrowser entitylink="prospect" isid="true" visible="false" />
      <fieldbrowser entitylink="codigo" visible="true"/>
      <fieldbrowser entitylink="razaosocial" visible="true"/>
    </fieldsbrowser>
  </viewbrowser>
  <forms>
    <form name="default" label="Negocio">
      <layout>
        <headerform>

          <row>
            <cell controltype="textedit" label="codigo" colspan="6" entitylink="codigo">
              <validates>
                <validate type="vnull" displaytext="O campo codigo não pode estar vazio"></validate>
              </validates>
            </cell>

            <cell controltype="textedit" label="razaosocial" colspan="6" entitylink="razaosocial">
              <validates>
                <validate type="vnull" displaytext="O campo razaosocial não pode estar vazio"></validate>
              </validates>
            </cell>
          </row>

          <row>
            <cell controltype="textedit" label="nomefantasia" colspan="6" entitylink="nomefantasia">
            </cell>

            <cell controltype="textedit" label="cnpj" colspan="6" entitylink="cnpj">
              <validates>
                <validate type="vnull" displaytext="O campo cnpj não pode estar vazio"></validate>
              </validates>
            </cell>
          </row>

          <row>
            <cell label="segmentoatuacao" entitylink="segmentoatuacao" controltype="lookup" colspan="6" fielddetaillookup="{'codigo': 'Código', 'descricao':'Descrição'}" amountfieldslookup="4" allowinsertlookup="false">
            </cell>
          </row>

          <row>
            <cell entitylink="contatos" label="Contatos" controltype="objectlist" colspan="12" />
          </row>

        </headerform>
      </layout>
    </form>
  </forms>
  <actions>
    <action form="default" successMsg="O Negócio foi criado com sucesso!">
      <name>Insert</name>
      <api>
        <name>prospectNovo</name>
        <fromto valueapi="codigo" valueentity="codigo" />
        <fromto valueapi="nome" valueentity="razaosocial" />
        <fromto valueapi="nomefantasia" valueentity="nomefantasia" />
        <fromto valueapi="cnpj" valueentity="cnpj" />
        <fromto valueapi="id_grupoempresarial" valueentity="id_grupoempresarial" />
        <fromto valueapi="created_by" valueentity="logged_user" />
        <fromto valueapi="tenant" valueentity="tenant" />
        <fromto valueapi="segmentoatuacao" valueentity="segmentoatuacao" />
        <fromto valueapi="contatos" valueentity="contatos" />
      </api>
    </action>
  </actions>
</nsjusecase>