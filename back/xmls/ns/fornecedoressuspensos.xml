<?xml version="1.0" encoding="UTF-8"?>
<nsjusecase xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../vendor/nasajon/mdatransformer/schemas/nsjusecase.xsd" name="fornecedoressuspensos" label="fornecedoressuspensos" project="ns">
    <entity schema="ns" table="fornecedoressuspensos"> 
        <fieldmodel name="fornecedorsuspenso" datatype="guid" isid="true" column="fornecedorsuspenso"/> 
        <fieldmodel name="fornecedor" datatype="guid" column="fornecedor_id"/>
        <fieldmodel name="fornecedoresfilter" datatype="guid" notMapped="true"  useCaseLink="ns\fornecedores" entityJoinType="left"/>
        <fieldmodel name="created_at" datatype="datetime" column="created_at" /> 
        <fieldmodel name="tipo" datatype="integer" column="tipo">
            <options>{"1":"Suspensão","2":"Banimento"}</options>
        </fieldmodel>
        <fieldmodel name="motivo_suspensao" datatype="string" column="motivo_suspensao"/>
        <fieldmodel name="data_fim" datatype="datetime" column="data_fim"/> 
        <fieldmodel name="tenant" datatype="integer" column="tenant"/>
        <fieldmodel name="razaosocial" datatype="string" notMapped="true"/>
        <fieldmodel name="cnpj" datatype="string" notMapped="true"/>
        <fieldmodel name="fornecedores" datatype="guid" column="fornecedor_id" useCaseLink="ns\fornecedores" entityJoinType="left"/>
        <fieldmodel name="motivoremocaosuspensao" datatype="string" notMapped="true" />
        <fieldmodel name="id_grupoempresarial" datatype="guid" column="id_grupoempresarial"/> 
    </entity>
    <constructors>
        <constructoritem required="true">tenant</constructoritem>     
        <constructoritem>id_grupoempresarial</constructoritem>
    </constructors>
    <viewbrowser label="Prestadoras de Serviços Suspensas" layout="list" paginate="true" target="builtin">
      <filters style="fixed">
        <fieldsfilters>
            <fieldfilter entitylink="fornecedoresfilter" visible="false" maxoccurs='unbounded' >
              <lookup fielddetail="{'nome':'Nome'}" allowinsert="false" />
                 <conditions>
                     <condition type="eq"/>
                 </conditions>
            </fieldfilter>
          </fieldsfilters>
      </filters>  
      <fieldsbrowser>
            <fieldbrowser entitylink="fornecedorsuspenso" isid="true" visible="false" />
            <fieldbrowser entitylink="fornecedor" visible="false" />
            <fieldbrowser alias="Razão Social" entitylink="fornecedores" visible="true"  fielddetaillookup="{'razaosocial': 'Nome'}" />
            <fieldbrowser entitylink="fornecedoresfilter" visible="false" cansearch="false" fielddetaillookup="{'nome': 'Nome'}" />
          </fieldsbrowser>
        <emptybuiltin title="Selecione uma Prestadora de Serviços Suspensa" gender="f">Selecione uma Prestadora de Serviço Suspensa no painel ao lado para ver suas informações.</emptybuiltin>
     </viewbrowser>
     <forms>
      <form name="show" label="Prestadora de Serviço Suspensa">
          <layout>
              <headerform>
                <row>
                  <cell>
                    <groupbox>
                      <caption text="Informações Gerais"></caption>
                      <row>
                        <cell label="Nome Fantasia" colspan="12" name="fornecedores" controltype="lookup" entitylink="fornecedores" fielddetaillookup="{'nomefantasia':'Nome Fantasia','razaosocial':'Razão Social', 'cnpj':'CNPJ'}" amountfieldslookup="3" allowinsertlookup="true"/>
                      </row>
                      <row>
                        <cell label="Razão Social" colspan="12" name="razaosocial" controltype="textedit" entitylink="razaosocial"/>
                      </row>
                      <row>
                        <cell label="CNPJ" colspan="12" name="cnpj" controltype="cnpj" mask="99.999.999/9999-9" entitylink="cnpj"/>
                      </row>
                    </groupbox>
                  </cell>
                </row>
                <row>
                  <cell>
                    <groupbox>
                      <caption text="Ficha de Suspensão"></caption>
                      <row>
                        <cell name="tipo" controltype="combobox" label="Tipo" colspan="12" entitylink="tipo" />
                      </row>
                      <row>
                        <cell name="motivo_suspensao" controltype="textedit" label="Justificativa" colspan="12" entitylink="motivo_suspensao" />
                      </row> 
                      <row> 
                        <cell name="created_at" controltype="dateedit" label="Data de Suspensão" colspan="6" entitylink="created_at"/>
                        <cell name="data_fim" controltype="dateedit" label="Data de Liberação" colspan="6" entitylink="data_fim" />
                      </row>
                    </groupbox>
                  </cell>
                </row>  
              </headerform>           
          </layout>
      </form>
      <form name="fornecedorreativar" label="Remover Suspensão">
          <layout>
              <headerform>
                  <row>
                      <cell name="motivoremocaosuspensao" defaultvalue="" entitylink="motivoremocaosuspensao" colspan="12" label="Motivo" controltype="textarea"/>
                  </row>
              </headerform>
          </layout>
      </form>
     </forms>
     <actions>
        <action form="show">
          <name>retrieve</name>
        </action>
        <!-- Label do botão definida no show.html.twig sobrescrito -->
        <action form="fornecedorreativar" emptyform="true" appendto="view" label="" color="green" icon="none" method="post" successMsg="A Suspensão foi removida com sucesso!" failMsg="Ocorreu um erro ao remover a Suspensão!" >
            <name>fornecedorreativar</name>
            <api>
                <name>fornecedorreativar_v3</name>
                <fromto valueapi="fornecedor_id" valueentity="fornecedor" />
                <fromto valueapi="tenant" valueentity="tenant" /> 
                <fromto valueapi="motivo_reativacao" valueentity="motivoremocaosuspensao"/>
                <fromto valueapi="created_by" valueentity="logged_user"/>
                <fromto valueapi="id_grupoempresarial" valueentity="id_grupoempresarial" />
            </api> 
        </action> 
    </actions>
</nsjusecase>
